!function(e,t){"function"==typeof define&&define.amd?define(["mod_treasurehunt/ol"],t):"object"==typeof module&&module.exports?module.exports=t(require("mod_treasurehunt/ol")):e.LayerSwitcher=t(e.ol)}(this,function(h){return h.control.LayerSwitcher=function(e){var t=e||{},n=t.tipLabel?t.tipLabel:"Legend";this.mapListeners=[],this.hiddenClassName="ol-unselectable ol-control layer-switcher",h.control.LayerSwitcher.isTouchDevice_()&&(this.hiddenClassName+=" touch"),this.shownClassName="shown";var r=document.createElement("div");r.className=this.hiddenClassName;var o=document.createElement("button");o.setAttribute("title",n),r.appendChild(o),this.panel=document.createElement("div"),this.panel.className="panel",r.appendChild(this.panel),h.control.LayerSwitcher.enableTouchScroll_(this.panel);var i=this;o.onmouseover=function(e){i.showPanel()},o.onclick=function(e){e=e||window.event,i.showPanel(),e.preventDefault()},i.panel.onmouseout=function(e){e=e||window.event,i.panel.contains(e.toElement||e.relatedTarget)||i.hidePanel()},h.control.Control.call(this,{element:r,target:t.target})},h.inherits(h.control.LayerSwitcher,h.control.Control),h.control.LayerSwitcher.prototype.showPanel=function(){this.element.classList.contains(this.shownClassName)||(this.element.classList.add(this.shownClassName),this.renderPanel())},h.control.LayerSwitcher.prototype.hidePanel=function(){this.element.classList.contains(this.shownClassName)&&this.element.classList.remove(this.shownClassName)},h.control.LayerSwitcher.prototype.renderPanel=function(){for(this.ensureTopVisibleBaseLayerShown_();this.panel.firstChild;)this.panel.removeChild(this.panel.firstChild);var e=document.createElement("ul");this.panel.appendChild(e),this.renderLayers_(this.getMap(),e)},h.control.LayerSwitcher.prototype.setMap=function(e){for(var t=0;t<this.mapListeners.length;t++)h.Observable.unByKey(this.mapListeners[t]);if(this.mapListeners.length=0,h.control.Control.prototype.setMap.call(this,e),e){var n=this;this.mapListeners.push(e.on("pointerdown",function(){n.hidePanel()})),this.renderPanel()}},h.control.LayerSwitcher.prototype.ensureTopVisibleBaseLayerShown_=function(){var r;h.control.LayerSwitcher.forEachRecursive(this.getMap(),function(e,t,n){"base"===e.get("type")&&e.getVisible()&&(r=e)}),r&&this.setVisible_(r,!0)},h.control.LayerSwitcher.prototype.setVisible_=function(r,e){var t=this.getMap();r.setVisible(e),e&&"base"===r.get("type")&&h.control.LayerSwitcher.forEachRecursive(t,function(e,t,n){e!=r&&"base"===e.get("type")&&e.setVisible(!1)})},h.control.LayerSwitcher.prototype.renderLayer_=function(t,e){var n=this,r=document.createElement("li"),o=t.get("title"),i=h.control.LayerSwitcher.uuid(),a=document.createElement("label");if(t.getLayers&&!t.get("combine")){r.className="group",a.innerHTML=o,r.appendChild(a);var s=document.createElement("ul");r.appendChild(s),this.renderLayers_(t,s)}else{r.className="layer";var c=document.createElement("input");"base"===t.get("type")?(c.type="radio",c.name="base"):c.type="checkbox",c.id=i,c.checked=t.get("visible"),c.onchange=function(e){n.setVisible_(t,e.target.checked)},r.appendChild(c),a.htmlFor=i,a.innerHTML=o;var l=this.getMap().getView().getResolution();(l>t.getMaxResolution()||l<t.getMinResolution())&&(a.className+=" disabled"),r.appendChild(a)}return r},h.control.LayerSwitcher.prototype.renderLayers_=function(e,t){for(var n,r=e.getLayers().getArray().slice().reverse(),o=0;o<r.length;o++)(n=r[o]).get("title")&&t.appendChild(this.renderLayer_(n,o))},h.control.LayerSwitcher.forEachRecursive=function(e,r){e.getLayers().forEach(function(e,t,n){r(e,t,n),e.getLayers&&h.control.LayerSwitcher.forEachRecursive(e,r)})},h.control.LayerSwitcher.uuid=function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})},h.control.LayerSwitcher.enableTouchScroll_=function(e){if(h.control.LayerSwitcher.isTouchDevice_()){var t=0;e.addEventListener("touchstart",function(e){t=this.scrollTop+e.touches[0].pageY},!1),e.addEventListener("touchmove",function(e){this.scrollTop=t-e.touches[0].pageY},!1)}},h.control.LayerSwitcher.isTouchDevice_=function(){try{return document.createEvent("TouchEvent"),!0}catch(e){return!1}},h.control.LayerSwitcher});